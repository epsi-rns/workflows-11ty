
{%- set posts = posts | mapdate -%}
{%- set groupByYear = posts | groupBy('year') | dictsort | reverse -%}

{%- for year, postsInYear in groupByYear -%}
<div id="archive">
  <div>
    <div class ="anchor-target archive-year p-b-5" 
         id="{{ year }}">
      {%- if year == (metadata.now | date("Y")) -%}
        <strong>This year's posts ({{ year }})</strong>
      {%- else -%}
        <strong>{{ year }}</strong>
      {%- endif -%}
    </div>

    {%- set groupByMonth = postsInYear | groupBy('month') -%}
    {%- set groupByMonth = groupByMonth | dictsort | reverse -%}

    <div class="columns is-multiline p-y-5">
    {%- for month, postsInMonth in groupByMonth -%}
    <section class="column is-full-mobile
              is-half-tablet is-one-third-widescreen">

      <div class="widget white z-depth-1 hoverable m-b-10">
        <div class="widget-header {{ color }} lighten-4">

          <div class ="archive-month" 
               id="{{ year }}-{{ month }}">
            {{ postsInMonth[0].monthtext }}</div>

        </div>
        <div class="widget-body">

          <div class="archive-list">
            {%- for post in postsInMonth | sort(false, true, 'month') -%}
            <div class="archive-item meta-item"">
              <div class="meta_link has-text-right">
                <time class="meta_time is-pulled-right"
                      datetime="{{ post.date | date() }}">
                  {{ post.date | date('MMM DD, Y') }}&nbsp;
                  &nbsp;<span class="fa fa-calendar"></span></time></div>
              <div class="is-pulled-left">
              <a href="{{ post.url | url }}">
                {{ post.data.title }}
              </a></div>
              <div class="is-clearfix"></div>
            </div>
            {%- endfor -%}
          </div>

        </div>
      </div>

    </section>
    {%- endfor -%}
    </div>

  </div>

{%- endfor -%}
</div>
